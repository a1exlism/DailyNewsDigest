# 开发指南

## 项目概览

### 目的

- 每天从 Hacker News 生成新闻摘要并发布。

### 技术栈

- Python
- 用于 AI 摘要的潜在 LLM 库。
- 用于 HTTP 请求的 `requests` 或类似库。
- Notion API 客户端。
- Telegram API 客户端。

## 项目架构

### 目录结构与模块划分

- **根目录 (`/`)**: 包含项目的主入口 (`main.py`)、配置文件 (`CLAUDE.md`, `shrimp-rules.md`, `requirements.txt`) 和顶级模块目录。
- **`config/`**: 存放项目配置，例如 `settings.py`。
  - **应做**: 所有项目配置参数应集中管理于 `config/settings.py`。
  - **不应做**: 配置项不应散布在各个模块文件中。
- **`data_acquisition/`**: 负责数据获取。
  - **`hackernews.py`**: 处理 Hacker News API 交互。
  - **`web_scraper.py`**: 用于抓取原始文章内容。
  - **应做**: 所有外部数据源的获取逻辑必须在此层实现。
  - **不应做**: 其他层级不应直接进行数据获取操作。
- **`data_processing/`**: 负责数据处理和 AI 摘要。
  - **`llm_summarizer.py`**: 实现 AI 摘要功能。
  - **应做**: 所有新闻和评论的总结逻辑必须在此层实现。
  - **不应做**: 其他层级不应包含数据处理的核心逻辑。
- **`data_output/`**: 负责数据格式化和输出。
  - **`notion_publisher.py`**: 处理将处理后的数据发布到 Notion。
  - **`schemas.py`**: 定义数据输出的结构。
  - **应做**: 所有最终数据的格式化和发布到外部平台（如 Notion）的逻辑必须在此层实现。
  - **不应做**: 其他层级不应直接与 Notion API 交互。
- **`notification/`**: 负责通知。
  - **`telegram_notifier.py`**: 实现 Telegram 通知功能。
  - **应做**: 所有执行结果的通知逻辑必须在此层实现。
  - **不应做**: 其他层级不应直接发送通知。
- **`tests/`**: 存放所有测试文件。
  - **应做**: 为所有核心功能编写单元测试和集成测试。
  - **不应做**: 将测试文件放置在其他目录中。
- **`utils/`**: 存放通用工具函数。
  - **`http_client.py`**: 通用 HTTP 客户端。
  - **`logger.py`**: 日志记录工具。
  - **应做**: 编写通用的辅助函数或类，供其他模块复用。
  - **不应做**: 在核心业务逻辑模块中包含通用工具代码。

## 代码标准

### 命名约定

- **文件和目录**: 使用 `snake_case` (例如 `data_acquisition`, `hackernews.py`)。
- **类名**: 使用 `CamelCase` (例如 `HackernewsClient`, `LLMSummarizer`)。
- **函数和变量**: 使用 `snake_case` (例如 `fetch_top_stories`, `article_content`)。
- **应做**: 严格遵循 Python PEP 8 命名规范。
- **不应做**: 使用 `camelCase` 或其他不符合 PEP 8 的命名方式。

### 格式化

- **应做**: 遵循 Python PEP 8 编码风格指南。使用 `black` (如果已安装) 进行代码格式化。
- **不应做**: 使用不一致的缩进或空格。

### 注释和文档字符串 (Docstrings)

- **应做**: 所有公共模块、类和函数必须包含 Docstrings，解释其目的、参数和返回值。复杂逻辑应包含行内注释。
- **不应做**: 遗漏关键函数或类的文档，或使用不清晰的注释。

## 功能实现标准

### 实现新功能

- **应做**: 在对应的架构层（`data_acquisition`, `data_processing`, `data_output`, `notification`）下创建新的模块或扩展现有模块。
  - _示例_: 添加新的新闻源，应在 `data_acquisition/` 下创建 `new_source.py`。
- **不应做**: 在不相关的模块中添加新功能代码，或打破层级职责。

### 修改现有功能

- **应做**: 遵循现有代码风格和架构模式进行修改。
- **不应做**: 引入不兼容的更改或忽略现有模块的职责。

## 框架/插件/第三方库使用标准

### 依赖管理

- **应做**: 引入任何新的 Python 库时，必须将其添加到 `requirements.txt` 文件中，并指定版本。
- **不应做**: 引入未在 `requirements.txt` 中声明的依赖。

### 外部 API 交互

- **应做**: 所有外部 API 交互（如 Hacker News API, Notion API, Telegram API）必须通过各自的封装模块进行，例如 `data_acquisition/hackernews.py`, `data_output/notion_publisher.py`。
- **不应做**: 在核心业务逻辑或不相关的模块中直接进行外部 API 调用。

## 工作流标准

### 依赖安装

- **应做**: 在进行任何开发或代码执行前，必须运行 `pip install -r requirements.txt` 以确保所有依赖都已安装。
- **不应做**: 假设依赖已安装而直接运行代码。

### 脚本执行

- **应做**: 使用 `python your_script_name.py` 命令执行 Python 脚本。
- **不应做**: 使用其他不标准的执行方式。

### 测试

- **应做**: 使用 `pytest` 命令运行项目测试（例如 `pytest` 或 `pytest tests/test_placeholder.py`）。
- **不应做**: 在没有运行测试的情况下提交代码更改。

## 关键文件交互标准

### `CLAUDE.md` 和 `shrimp-rules.md`

- **应做**: 当项目的高级架构、核心开发任务或 AI Agent 的指导原则发生变更时，这两个文件必须同步更新以保持一致性。
- **不应做**: 仅更新其中一个文件而忽略另一个。

### `requirements.txt`

- **应做**: 当添加或移除任何 Python 依赖时，必须更新 `requirements.txt`。
- **不应做**: 引入新的依赖但未更新 `requirements.txt`。

### `config/settings.py`

- **应做**: 所有项目级别的配置参数都应在此文件中定义和修改。
- **不应做**: 将配置参数硬编码在其他模块中。

## AI 决策标准

### 任务优先级

- **应做**: 优先处理用户明确指定或紧急的安全相关任务。
- **应做**: 其次是核心功能的实现和维护任务。
- **应做**: 然后是性能优化、代码重构和文档更新任务。
- **不应做**: 在有更紧急任务时，优先处理低优先级的任务。

### 信息收集

- **应做**: 在对任何文件进行修改之前，必须使用 `Read` 工具仔细阅读目标文件及其相关的上下文文件，以充分理解其现有逻辑和依赖。
- **不应做**: 在没有充分理解代码库的情况下，盲目进行修改。

### 不确定性处理

- **应做**: 如果对某个实现方案存在不确定性，或需要了解最佳实践，应首先搜索项目内部代码和文档。如果内部信息不足，可使用 `WebSearch` 工具查询外部资源。
- **不应做**: 在信息不足时，进行猜测或凭空生成解决方案。

## 禁止行为

- **敏感信息**: **严禁**读取、修改、暴露或在任何日志、输出中包含 `.env` 文件或任何可能包含敏感凭据（如 API 密钥、数据库密码）的文件内容。
- **通用文档**: **严禁**生成任何通用开发文档或 README 文件，除非用户明确要求。
- **恶意代码**: **严禁**创建、修改或改进任何可能用于恶意目的（如安全漏洞、数据窃取、未经授权的访问）的代码或工具。
- **未经授权的更改**: **严禁**在未获得明确指令的情况下，擅自修改项目核心架构、引入新的顶级依赖或进行大规模重构。
- **猜测行为**: **严禁**在信息不足时进行猜测。所有决策必须基于已验证的信息。
- **解释项目功能**: **严禁**在`shrimp-rules.md`中解释项目功能的工作原理，而应专注于如何修改或添加功能。
